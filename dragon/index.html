<!--
 * @Author: liupeixin liupx@nancal.com
 * @Date: 2022-08-01 17:37:30
 * @LastEditors: liupeixin liupx@nancal.com
 * @LastEditTime: 2022-08-05 10:59:08
 * @FilePath: /my-blog/source/dragon/index.html
 * @Description: 
 * 
 * Copyright (c) 2022 by liupeixin liupx@nancal.com, All Rights Reserved. 
-->

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>生成日报</title>
  <style>
    .content {
      display: flex;
      justify-content: center;
      align-content: flex-start;
      align-items: center;
      flex-direction: column;
    }

    .btn {
      height: 30px;
      margin-right: 8px;
      margin-bottom: 12px;
      border-radius: 3px;
      border: 1px solid #1890ff;
      color: #fff;
      background-color: #1890ff;
      text-shadow: 0 -1px 0 rgb(0 0 0 / 12%);
      box-shadow: 0 2px 0 rgb(0 0 0 / 5%);
    }
  </style>
</head>

<body>
  <div class="content">
    <h2 id="name"></h2>
    <h2 id="project"></h2>
    <br>
    <div>
      <textarea id="story" name="story" rows="6" cols="33"></textarea>
    </div>
    <br>
    <div>
      <button class="btn" type="submit" onclick="generateDailyReport()">
        <strong>生成日报</strong>
      </button>
      <button class="btn" type="submit" onclick="copyToClipBoard()">
        <strong>复制日报</strong>
      </button>
    </div>
    <br>
    <div id="res"></div>
  </div>
</body>
<script type="text/javascript">
  userList = {
    xjl: '薛锦龙',
    tk: '拓凯',
    qxb: '齐信彬',
  },
  projectList = {
    process: '624工艺',
  }
  window.onload = init()
  function init() {
    window.location.search.substring(1).split('&').forEach(function (item) {
      let arr = item.split('=')
      console.log(arr)
      if (arr[0] == 'name') {
        document.getElementById("name").innerHTML = userList[arr[1]]
      } else if (arr[0] == 'project') {
        document.getElementById("project").innerHTML = projectList[arr[1]]
      }
    })
  }
  function getTimeByZone(timezone = 8, date) {
    // 本地时间距离（GMT时间）毫秒数
    let nowDate = !date ? new Date().getTime() : new Date(date).getTime()
    // 本地时间和格林威治时间差，单位分钟
    let offset_GMT = new Date().getTimezoneOffset()
    //  反推到格林尼治时间
    let GMT = nowDate + offset_GMT * 60 * 1000
    //  获取指定时区时间
    let targetDate = new Date(GMT + timezone * 60 * 60 * 1000)
    return targetDate
  }
  function formatDate() {
    let nowTime = new Date()
    let time = getTimeByZone(-3, nowTime)
    let nowData = new Date(time)
    let month = nowData.getMonth() + 1
    let day = nowData.getDate()
    return month + '月' + day + '日'
  }
  let generateDailyReport = function () {
    let content = document.getElementById("story").value;
    let name = document.getElementById("name").innerText;
    let project = document.getElementById("project").innerText;
    let nowTime = new Date()
    let time = getTimeByZone(-3, nowTime)
    let nowData = new Date(time)
    let weekday = new Array("周日", "周一", "周二", "周三", "周四", "周五", "周六")
    let res = '工作日报' + ' ' + name + ' ' + formatDate() + ' ' + weekday[nowData.getDay()] + '<br>' + project
    let text = content.split('\n')
    let arr = text.filter(str => !!str);
    arr.forEach(function (item, index) {
      res += '<br>' + (index + 1) + '.' + item
    })
    document.getElementById("res").innerHTML = res
  }
  function copyToClipBoard() {
    let text = document.getElementById("res").innerText
    var textareaC = document.createElement('textarea');
    textareaC.setAttribute('readonly', 'readonly'); //设置只读属性防止手机上弹出软键盘
    textareaC.value = text;
    document.body.appendChild(textareaC); //将textarea添加为body子元素
    textareaC.select();
    let res = document.execCommand('copy');
    document.body.removeChild(textareaC);//移除DOM元素
    return res;
  }
</script>

</html>