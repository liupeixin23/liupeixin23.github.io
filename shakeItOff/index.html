<!--
 * @Author: liupeixin liupx@nancal.com
 * @Date: 2022-08-19 11:24:24
 * @LastEditors: liupeixin liupx@nancal.com
 * @LastEditTime: 2022-08-19 11:24:51
 * @FilePath: /my-blog/source/shakeItOff/index.html
 * @Description: 
 * 
 * Copyright (c) 2022 by liupeixin liupx@nancal.com, All Rights Reserved. 
-->
<!--
 * @Author: liupeixin liupx@nancal.com
 * @Date: 2022-08-19 11:24:24
 * @LastEditors: liupeixin liupx@nancal.com
 * @LastEditTime: 2022-08-19 11:24:34
 * @FilePath: /my-blog/source/shakeItOff/index.html
 * @Description: 
 * 
 * Copyright (c) 2022 by liupeixin liupx@nancal.com, All Rights Reserved. 
-->
<body>
  <button id="btn">开启摇一摇</button>
  <button id="stopBtn">关闭摇一摇</button>
  <div id="info"></div>
  <script src="motion.js"></script>
  <script>
      let btn = document.querySelector("#btn");
      let stopBtn  = document.querySelector("#stopBtn");
      /*
   setShake 摇一摇
     ops : {
       start:fn // 开始摇一摇时要做的事情
       shake:fn // 摇一摇中要做得事情
       end: fn// 摇一摇结束后要做的事情
     }
  */
      function setShake(ops) {
          const { start = () => { }, shake = () => { }, end = () => { } } = ops;
          let lastX = 0,
              lastY = 0,
              lastZ = 0;
          const maxRange = 50;
          const minRange = 5;
          let isShake = false;
          const unMotion = setMotion(throttle((e) => {
              const { x, y, z } = e.acceleration;
              const range = Math.abs(x - lastX) + Math.abs(y - lastY) + Math.abs(z - lastZ);
              if (range > maxRange && (!isShake)) {
                  start(e);
                  isShake = true;
              } else if (range > maxRange && isShake) {
                  shake(e);
              } else if (range < minRange && isShake) {
                  end(e);
                  isShake = false;
              }
              lastX = x;
              lastY = y;
              lastZ = z;
          }));
          return unMotion; //取消摇一摇监听
      }
      let unShake;
      btn.addEventListener("touchend", () => { 
          unShake = setShake({
              start:()=>{
                  info.innerHTML += "开始摇一摇<br/>";
              },
              shake:()=>{
                  info.innerHTML += "摇一摇中<br/>";
              },
              end: ()=>{
                  info.innerHTML += "摇一摇结束<br/>";
              }
          })
      });
      stopBtn.addEventListener("touchend",()=>{
          if(unShake){
              unShake();
          }
      })


  </script>
</body>